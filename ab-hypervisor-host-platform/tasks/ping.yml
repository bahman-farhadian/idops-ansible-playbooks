---
- name: Check Ansible connectivity
  ansible.builtin.ping:

- name: Check virtualization extensions support flag
  ansible.builtin.command:
    cmd: "egrep -c '(vmx|svm)' /proc/cpuinfo"
  register: virt_extensions_count
  changed_when: false

- name: Check libvirt command availability
  ansible.builtin.command:
    cmd: virsh --version
  register: virsh_version
  changed_when: false
  failed_when: false

- name: Display hypervisor ping summary
  ansible.builtin.debug:
    msg: >-
      Host reachable | virtualization_extensions={{ virt_extensions_count.stdout | default('0') }} |
      virsh={{ virsh_version.stdout | default('not installed') }}
