---
- name: Manage hypervisor host platform
  hosts: hypervisor
  become: true
  gather_facts: true
  vars_files:
    - vars/hypervisor.yml
  vars:
    hypervisor_action: "{{ hypervisor_action | default('configure') }}"

  tasks:
    - name: Validate requested action
      ansible.builtin.assert:
        that:
          - hypervisor_action in ['configure', 'ping']
        fail_msg: "hypervisor_action must be 'configure' or 'ping'."

    - name: Run hypervisor connectivity checks
      ansible.builtin.include_tasks: tasks/ping.yml
      when: hypervisor_action == 'ping'

    - name: Run hypervisor platform configuration
      ansible.builtin.include_tasks: tasks/configure.yml
      when: hypervisor_action == 'configure'
