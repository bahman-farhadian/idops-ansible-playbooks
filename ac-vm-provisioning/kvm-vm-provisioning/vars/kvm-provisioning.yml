---
# KVM VM Provisioning configuration
#
# This file is the single source of user-editable settings.
# Naming follows an explicit, production-grade convention.

# -----------------------------------------------------------------------------
# Hypervisor connection
# -----------------------------------------------------------------------------
kvm_hypervisor_host: "Selene"
kvm_hypervisor_python_interpreter: "/usr/bin/python3"

# -----------------------------------------------------------------------------
# Instance pool and execution behavior
# -----------------------------------------------------------------------------
kvm_instance_pool_path: "/home/bahman/b/QEMUKVM/stgPool/"
kvm_default_clone_disk_extension: "qcow2"
kvm_clone_workspace_path: "/tmp/idops-kvm-workspace/"
kvm_cleanup_workspace_path_after_run: true

# -----------------------------------------------------------------------------
# Guest network defaults (can be overridden per template or per instance)
# -----------------------------------------------------------------------------
kvm_default_guest_network_interface: "enp1s0"
kvm_default_guest_network_prefix: "24"
kvm_default_guest_network_gateway: "192.168.24.1"
kvm_default_guest_dns_servers:
  - "1.1.1.1"
  - "8.8.8.8"

# -----------------------------------------------------------------------------
# Snapshot and workflow behavior
# -----------------------------------------------------------------------------
kvm_snapshot_enabled: true
kvm_snapshot_name: "snapshot-a"
kvm_snapshot_description: "initial configuration"
kvm_start_instances_after_snapshot: true
# Ensure all requested instances are running during provision, not only newly created ones.
kvm_ensure_requested_instances_running: true
kvm_restart_template_instances_after_run: false
kvm_wait_for_instance_ssh: true
kvm_execute_mutation_phases_in_check_mode: false
kvm_cleanup_confirmed: false
kvm_clone_mode: "parallel"  # auto | sequential | parallel
kvm_clone_async_timeout_seconds: 1800
kvm_clone_wait_retries: 180
kvm_clone_wait_delay_seconds: 10

# -----------------------------------------------------------------------------
# Runtime access behavior (libvirt/qemu user)
# -----------------------------------------------------------------------------
# Enable preflight check to ensure libvirt runtime user can traverse/read paths.
kvm_validate_runtime_pool_access: true
# When enabled, automatically apply ACLs for runtime user on pool path and
# template disk files if preflight access fails.
kvm_auto_fix_runtime_pool_access: true
kvm_libvirt_runtime_user: "libvirt-qemu"

# -----------------------------------------------------------------------------
# Template validation behavior
# -----------------------------------------------------------------------------
# always: validate template instance existence/state every run
# once: validate once and create marker files, later runs skip repeated checks
kvm_template_validation_mode: "once"  # always | once
kvm_template_validation_state_dir: "/var/tmp/idops-kvm-template-validation"

# -----------------------------------------------------------------------------
# Template catalog
# -----------------------------------------------------------------------------
# guest_os_variant:
#   - debian
#   - ubuntu
# guest_network_mode:
#   - ifupdown : writes /etc/network/interfaces
#   - netplan  : writes /etc/netplan/99-idops-static.yaml
#
# template_instance_disk_files must be a list of full paths on the hypervisor.
# This enables explicit operator control over template disk file sources.

kvm_template_catalog:
  debian-bookworm:
    template_instance_name: "debian-bookworm"
    template_instance_disk_files:
      - "/home/bahman/b/QEMUKVM/stgPool/debian-bookworm.qcow2"
    guest_os_variant: "debian"
    guest_network_mode: "ifupdown"
    guest_network_interface: "enp1s0"

  ubuntu-noble:
    template_instance_name: "ubuntu-24-04-template"
    template_instance_disk_files:
      - "/var/lib/libvirt/images/ubuntu-24-04-template.qcow2"
    guest_os_variant: "ubuntu"
    guest_network_mode: "netplan"
    guest_network_interface: "ens3"
    netplan_renderer: "networkd"

# -----------------------------------------------------------------------------
# Instance definitions
# -----------------------------------------------------------------------------
# Required per instance:
# - instance_name
# - template_profile_id
# - instance_ipv4_address
# - vcpu_count
# - memory_mb
#
# Optional per-instance overrides:
# - template_instance_name
# - template_instance_disk_files
# - guest_os_variant
# - guest_network_mode
# - guest_network_interface
# - guest_network_prefix
# - guest_network_gateway
# - guest_dns_servers
# - ssh_port
# - clone_disk_extension

kvm_instance_definitions:
  - instance_name: "debian-bookworm-01"
    template_profile_id: "debian-bookworm"
    instance_ipv4_address: "192.168.24.100"
    vcpu_count: 2
    memory_mb: 2048
