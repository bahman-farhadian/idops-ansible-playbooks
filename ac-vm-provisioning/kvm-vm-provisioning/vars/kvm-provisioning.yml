---
# KVM VM Provisioning configuration
#
# This file is the single source of user-editable settings.
# Naming follows an explicit, production-grade convention.

# -----------------------------------------------------------------------------
# Hypervisor connection
# -----------------------------------------------------------------------------
# kvm_hypervisor_host: SSH target for the KVM host.
# Values: SSH alias, FQDN, IP, or user@host. Example: "Selene", "root@192.168.24.10".
kvm_hypervisor_host: "Selene"
# kvm_hypervisor_python_interpreter: Python interpreter path on the hypervisor.
# Values: absolute path. Example: "/usr/bin/python3".
kvm_hypervisor_python_interpreter: "/usr/bin/python3"

# -----------------------------------------------------------------------------
# Instance pool and execution behavior
# -----------------------------------------------------------------------------
# kvm_instance_pool_path: Directory for cloned instance disks on hypervisor.
# Values: existing absolute directory path. Example: "/var/lib/libvirt/images/".
kvm_instance_pool_path: "/home/bahman/b/QEMUKVM/stgPool/"
# kvm_default_clone_disk_extension: Default disk file extension for cloned disks.
# Values: alphanumeric string. Common: "qcow2", "img".
kvm_default_clone_disk_extension: "qcow2"
# kvm_clone_workspace_path: Temporary workspace path for generated files.
# Values: absolute directory path. Should be different from kvm_instance_pool_path.
kvm_clone_workspace_path: "/tmp/idops-kvm-workspace/"
# kvm_cleanup_workspace_path_after_run: Remove workspace after provisioning finishes.
# Values: true | false.
kvm_cleanup_workspace_path_after_run: true

# -----------------------------------------------------------------------------
# Guest network defaults (can be overridden per template or per instance)
# -----------------------------------------------------------------------------
# kvm_default_guest_network_interface: Default NIC name inside guest.
# Values: interface name string. Example: "enp1s0", "ens3".
kvm_default_guest_network_interface: "enp1s0"
# kvm_default_guest_network_prefix: Default CIDR prefix length.
# Values: string/integer prefix. Example: "24".
kvm_default_guest_network_prefix: "24"
# kvm_default_guest_network_gateway: Default IPv4 gateway.
# Values: IPv4 address string. Example: "192.168.24.1".
kvm_default_guest_network_gateway: "192.168.24.1"
# kvm_default_guest_dns_servers: Default DNS servers list.
# Values: list of IP strings. Example: ["1.1.1.1", "8.8.8.8"].
kvm_default_guest_dns_servers:
  - "1.1.1.1"
  - "8.8.8.8"

# -----------------------------------------------------------------------------
# Snapshot and workflow behavior
# -----------------------------------------------------------------------------
# kvm_snapshot_enabled: Create snapshots after provisioning.
# Values: true | false.
kvm_snapshot_enabled: true
# kvm_snapshot_name: Snapshot label used by virsh.
# Values: string. Example: "snapshot-a".
kvm_snapshot_name: "snapshot-a"
# kvm_snapshot_description: Snapshot description text.
# Values: string.
kvm_snapshot_description: "initial configuration"
# kvm_start_instances_after_snapshot: Start created instances after snapshot phase.
# Values: true | false.
kvm_start_instances_after_snapshot: true
# kvm_ensure_requested_instances_running: Ensure requested instances are running even if pre-existing.
# Values: true | false.
kvm_ensure_requested_instances_running: true
# kvm_restart_template_instances_after_run: Restart template domains that were running before clone.
# Values: true | false.
kvm_restart_template_instances_after_run: false
# kvm_wait_for_instance_ssh: Wait for SSH reachability after start.
# Values: true | false.
kvm_wait_for_instance_ssh: true
# kvm_execute_mutation_phases_in_check_mode: Allow clone/start/mutate phases in --check mode.
# Values: true | false.
kvm_execute_mutation_phases_in_check_mode: false
# kvm_cleanup_confirmed: Safety confirmation switch for cleanup action.
# Values: true | false. Keep false unless intentional cleanup.
kvm_cleanup_confirmed: false
# kvm_cleanup_remove_instance_disks: Remove expected per-instance disk files during cleanup.
# Values: true | false. Default false for safer shared pools.
kvm_cleanup_remove_instance_disks: false
# kvm_cleanup_allow_template_instance_deletion: Allow cleanup to target template instance names.
# Values: true | false. Default false to protect templates.
kvm_cleanup_allow_template_instance_deletion: false
# kvm_clone_mode: Clone execution strategy.
# Values: "auto" | "sequential" | "parallel".
kvm_clone_mode: "parallel"
# kvm_clone_async_timeout_seconds: Max seconds per async clone task.
# Values: positive integer. Example: 1800.
kvm_clone_async_timeout_seconds: 1800
# kvm_clone_wait_retries: Poll retry count while waiting for clone completion.
# Values: positive integer. Example: 180.
kvm_clone_wait_retries: 180
# kvm_clone_wait_delay_seconds: Delay between clone status polls.
# Values: positive integer seconds. Example: 10.
kvm_clone_wait_delay_seconds: 10

# -----------------------------------------------------------------------------
# Runtime access behavior (libvirt/qemu user)
# -----------------------------------------------------------------------------
# kvm_validate_runtime_pool_access: Validate runtime user access to pool/template paths.
# Values: true | false.
kvm_validate_runtime_pool_access: true
# kvm_auto_fix_runtime_pool_access: Auto-apply ACL fixes when access validation fails.
# Values: true | false.
kvm_auto_fix_runtime_pool_access: true
# kvm_libvirt_runtime_user: Linux account used by libvirt to access disks.
# Values: user name string. Common: "libvirt-qemu", "qemu".
kvm_libvirt_runtime_user: "libvirt-qemu"

# -----------------------------------------------------------------------------
# Template validation behavior
# -----------------------------------------------------------------------------
# kvm_template_validation_mode: Template validation strategy.
# Values: "always" (every run) | "once" (marker-based cache).
kvm_template_validation_mode: "once"
# kvm_template_validation_state_dir: Marker directory used when mode is "once".
# Values: absolute directory path. Example: "/var/tmp/idops-kvm-template-validation".
kvm_template_validation_state_dir: "/var/tmp/idops-kvm-template-validation"

# -----------------------------------------------------------------------------
# Template catalog
# -----------------------------------------------------------------------------
# kvm_template_catalog: Map of template profiles.
# Keys: profile identifiers (for example "debian-bookworm", "ubuntu-noble").
# Per-profile fields:
# - template_instance_name: existing libvirt template domain name.
# - template_instance_disk_files: list of absolute template disk paths on hypervisor.
# - guest_os_variant: "debian" | "ubuntu".
# - guest_network_mode: "ifupdown" | "netplan".
# - guest_network_interface: NIC name string in guest.
# - netplan_renderer: optional for netplan mode. Common: "networkd", "NetworkManager".

kvm_template_catalog:
  debian-bookworm:
    # template_instance_name: source template domain used by virt-clone.
    template_instance_name: "debian-bookworm"
    # template_instance_disk_files: source template disks; all must exist.
    template_instance_disk_files:
      - "/home/bahman/b/QEMUKVM/stgPool/debian-bookworm.qcow2"
    # guest_os_variant: guest family for customization logic.
    guest_os_variant: "debian"
    # guest_network_mode: network config writer mode.
    guest_network_mode: "ifupdown"
    # guest_network_interface: default NIC for this profile.
    guest_network_interface: "enp1s0"

  ubuntu-noble:
    # template_instance_name: source template domain used by virt-clone.
    template_instance_name: "ubuntu-24-04-template"
    # template_instance_disk_files: source template disks; all must exist.
    template_instance_disk_files:
      - "/var/lib/libvirt/images/ubuntu-24-04-template.qcow2"
    # guest_os_variant: guest family for customization logic.
    guest_os_variant: "ubuntu"
    # guest_network_mode: network config writer mode.
    guest_network_mode: "netplan"
    # guest_network_interface: default NIC for this profile.
    guest_network_interface: "ens3"
    # netplan_renderer: renderer used in netplan YAML.
    netplan_renderer: "networkd"

# -----------------------------------------------------------------------------
# Instance definitions
# -----------------------------------------------------------------------------
# kvm_instance_definitions: List of requested VM instances.
# Required per instance:
# - instance_name: target libvirt domain name (must be unique).
# - template_profile_id: profile key from kvm_template_catalog, or template alias.
# - instance_ipv4_address: static IPv4 address.
# - vcpu_count: integer vCPU count.
# - memory_mb: integer memory in MB.
# Optional overrides:
# - template_instance_name, template_instance_disk_files
# - guest_os_variant ("debian" | "ubuntu")
# - guest_network_mode ("ifupdown" | "netplan")
# - guest_network_interface, guest_network_prefix, guest_network_gateway, guest_dns_servers
# - ssh_port (integer), clone_disk_extension (alphanumeric string)

kvm_instance_definitions:
  - instance_name: "debian-bookworm-01"
    template_profile_id: "debian-bookworm"
    instance_ipv4_address: "192.168.24.100"
    vcpu_count: 2
    memory_mb: 2048
