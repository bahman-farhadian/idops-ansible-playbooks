---
# KVM VM Provisioning configuration
# Single source of user-editable settings.

# -----------------------------------------------------------------------------
# Hypervisor connection
# -----------------------------------------------------------------------------
kvm_hypervisor_host: "Selene"  # SSH target for KVM host. Values: SSH alias | FQDN | IP | user@host.
kvm_hypervisor_python_interpreter: "/usr/bin/python3"  # Python path on hypervisor. Values: absolute path.

# -----------------------------------------------------------------------------
# Instance pool and execution behavior
# -----------------------------------------------------------------------------
kvm_instance_pool_path: "/home/bahman/b/QEMUKVM/stgPool/"  # Storage path for cloned instance disks. Values: existing absolute directory.
kvm_default_clone_disk_extension: "qcow2"  # Default clone disk extension. Values: alphanumeric (for example qcow2, img).
kvm_clone_workspace_path: "/tmp/idops-kvm-workspace/"  # Temporary workspace for generated files. Values: absolute directory (must differ from pool path when workspace cleanup=true).
kvm_cleanup_workspace_path_after_run: true  # Remove workspace at end of run. Values: true | false.

# -----------------------------------------------------------------------------
# Guest network defaults (can be overridden per template or per instance)
# -----------------------------------------------------------------------------
kvm_default_guest_network_interface: "enp1s0"  # Default NIC inside guest. Values: interface name string (for example enp1s0, ens3).
kvm_default_guest_network_prefix: "24"  # Default IPv4 prefix length. Values: prefix string/integer (for example 24).
kvm_default_guest_network_gateway: "192.168.24.1"  # Default IPv4 gateway. Values: IPv4 string.
kvm_default_guest_dns_servers:  # Default DNS resolvers. Values: list of IP strings.
  - "1.1.1.1"
  - "8.8.8.8"

# -----------------------------------------------------------------------------
# Snapshot and workflow behavior
# -----------------------------------------------------------------------------
kvm_snapshot_enabled: true  # Create snapshots after provisioning. Values: true | false.
kvm_snapshot_name: "snapshot-a"  # Snapshot name label. Values: string.
kvm_snapshot_description: "initial configuration"  # Snapshot description. Values: string.
kvm_start_instances_after_snapshot: true  # Start created instances after snapshot phase. Values: true | false.
kvm_ensure_requested_instances_running: true  # Ensure requested instances are running even if already existing. Values: true | false.
kvm_restart_template_instances_after_run: false  # Restart template domains that were running before provisioning. Values: true | false.
kvm_wait_for_instance_ssh: true  # Wait for SSH reachability after start phases. Values: true | false.
kvm_execute_mutation_phases_in_check_mode: false  # Allow clone/start/mutate in --check mode. Values: true | false.
kvm_cleanup_confirmed: false  # Safety flag for cleanup action. Values: true | false.
kvm_cleanup_remove_instance_disks: false  # Remove declared instance disk files during cleanup. Values: true | false.
kvm_cleanup_allow_template_instance_deletion: false  # Allow deleting template domain names via cleanup targets. Values: true | false.
kvm_clone_mode: "parallel"  # Clone strategy. Values: auto | sequential | parallel.
kvm_clone_async_timeout_seconds: 1800  # Max seconds per async clone job. Values: positive integer.
kvm_clone_wait_retries: 180  # Poll retries while waiting for clone jobs. Values: positive integer.
kvm_clone_wait_delay_seconds: 10  # Delay between clone status polls in seconds. Values: positive integer.

# -----------------------------------------------------------------------------
# Runtime access behavior (libvirt/qemu user)
# -----------------------------------------------------------------------------
kvm_validate_runtime_pool_access: true  # Validate runtime user path access before mutation phases. Values: true | false.
kvm_auto_fix_runtime_pool_access: true  # Auto-apply ACL fixes when runtime access checks fail. Values: true | false.
kvm_libvirt_runtime_user: "libvirt-qemu"  # Runtime disk-access user for libvirt/qemu. Values: Linux username.

# -----------------------------------------------------------------------------
# Template validation behavior
# -----------------------------------------------------------------------------
kvm_template_validation_mode: "once"  # Template validation mode. Values: always | once.
kvm_template_validation_state_dir: "/var/tmp/idops-kvm-template-validation"  # Marker directory when mode=once. Values: absolute directory.

# -----------------------------------------------------------------------------
# Template catalog
# -----------------------------------------------------------------------------
kvm_template_catalog:  # Template profile map. Keys: profile IDs.
  debian-bookworm:
    template_instance_name: "debian-bookworm"  # Source template domain name. Values: existing libvirt domain.
    template_instance_disk_files:  # Source template disk file list. Values: absolute file paths on hypervisor.
      - "/home/bahman/b/QEMUKVM/stgPool/debian-bookworm.qcow2"
    guest_os_variant: "debian"  # Guest OS variant. Values: debian | ubuntu.
    guest_network_mode: "ifupdown"  # Guest network writer mode. Values: ifupdown | netplan.
    guest_network_interface: "enp1s0"  # Guest NIC for network config. Values: interface name string.

  ubuntu-noble:
    template_instance_name: "ubuntu-24-04-template"  # Source template domain name. Values: existing libvirt domain.
    template_instance_disk_files:  # Source template disk file list. Values: absolute file paths on hypervisor.
      - "/var/lib/libvirt/images/ubuntu-24-04-template.qcow2"
    guest_os_variant: "ubuntu"  # Guest OS variant. Values: debian | ubuntu.
    guest_network_mode: "netplan"  # Guest network writer mode. Values: ifupdown | netplan.
    guest_network_interface: "ens3"  # Guest NIC for network config. Values: interface name string.
    netplan_renderer: "networkd"  # Netplan renderer for netplan mode. Values: networkd | NetworkManager.

# -----------------------------------------------------------------------------
# Instance definitions
# -----------------------------------------------------------------------------
kvm_instance_definitions:  # Target instance list for provision/cleanup actions.
  - instance_name: "debian-bookworm-01"  # Target libvirt domain name. Values: unique string.
    template_profile_id: "debian-bookworm"  # Template reference. Values: catalog key or template alias.
    instance_ipv4_address: "192.168.24.100"  # Instance static IPv4. Values: IPv4 string.
    vcpu_count: 2  # vCPU allocation. Values: positive integer.
    memory_mb: 2048  # Memory allocation in MB. Values: positive integer.
