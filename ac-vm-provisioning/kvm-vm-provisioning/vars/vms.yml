---
# KVM VM Provisioning configuration
#
# This file is the single source of user-editable settings.
# It supports mixed OS variants by using template profiles.

# -----------------------------------------------------------------------------
# Hypervisor connection
# -----------------------------------------------------------------------------
kvm_host: "change-me-hypervisor"
hypervisor_python_interpreter: "/usr/bin/python3"

# -----------------------------------------------------------------------------
# Storage and execution behavior
# -----------------------------------------------------------------------------
disk_pool: "/var/lib/libvirt/images"
default_clone_disk_ext: "qcow2"
clone_workspace_dir: "/tmp/idops-kvm-vm-provisioning"
cleanup_workspace: true

# -----------------------------------------------------------------------------
# Networking defaults (can be overridden per template profile or per VM)
# -----------------------------------------------------------------------------
default_guest_interface: "enp1s0"
default_network_prefix: "24"
default_network_gateway: "192.168.24.1"
default_dns_servers:
  - "1.1.1.1"
  - "8.8.8.8"

# -----------------------------------------------------------------------------
# Snapshot and workflow behavior
# -----------------------------------------------------------------------------
create_snapshot: true
snapshot_name: "snapshot-a"
snapshot_description: "initial configuration"
start_after_snapshot: true
restart_template_after: false
wait_for_ssh: true
confirm_delete: false
clone_mode: "auto"              # auto | sequential | parallel
clone_async_timeout_sec: 1800
clone_wait_retries: 180
clone_wait_delay_sec: 10

# -----------------------------------------------------------------------------
# Template profiles
# -----------------------------------------------------------------------------
# guest_os_variant:
#   - debian
#   - ubuntu
# guest_network_mode:
#   - ifupdown : writes /etc/network/interfaces
#   - netplan  : writes /etc/netplan/01-idops-static.yaml
#
# You can add as many template profiles as needed.

template_profiles:
  debian-trixie:
    template_vm: "debian-trixie-template"
    guest_os_variant: "debian"
    guest_network_mode: "ifupdown"
    guest_interface: "enp1s0"

  ubuntu-noble:
    template_vm: "ubuntu-24-04-template"
    guest_os_variant: "ubuntu"
    guest_network_mode: "netplan"
    guest_interface: "ens3"
    netplan_renderer: "networkd"

# -----------------------------------------------------------------------------
# VM definitions
# -----------------------------------------------------------------------------
# Required per VM:
# - name
# - template_profile
# - ip
# - vcpu
# - ram_mb
#
# Optional per VM overrides:
# - template_vm
# - guest_os_variant
# - guest_network_mode
# - guest_interface
# - network_prefix
# - network_gateway
# - dns_servers
# - ssh_port
# - clone_disk_ext

vms:
  - name: "debian-app-01"
    template_profile: "debian-trixie"
    ip: "192.168.24.110"
    vcpu: 2
    ram_mb: 2048

  - name: "ubuntu-ci-01"
    template_profile: "ubuntu-noble"
    ip: "192.168.24.120"
    vcpu: 2
    ram_mb: 4096
